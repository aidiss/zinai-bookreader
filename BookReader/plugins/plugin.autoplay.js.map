{"version":3,"file":"plugins/plugin.autoplay.js","mappings":"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","sources":["webpack://@internetarchive/bookreader/./src/plugins/plugin.autoplay.js"],"sourcesContent":["/*global BookReader */\n\n/**\n * Plugin which adds an autoplay feature. Useful for kiosk situations.\n */\njQuery.extend(BookReader.defaultOptions, {\n  enableAutoPlayPlugin: true\n});\n\n/**\n * @override BookReader.setup\n */\nBookReader.prototype.setup = (function(super_) {\n  return function (options) {\n    super_.call(this, options);\n\n    this.auto      = false;\n    this.autoTimer = null;\n    this.flipDelay = 5000;\n  };\n})(BookReader.prototype.setup);\n\n/**\n * @override BookReader.init\n */\nBookReader.prototype.init = (function(super_) {\n  return function (options) {\n    super_.call(this, options);\n\n    if (!this.options.enableAutoPlayPlugin) return;\n    this.bind(BookReader.eventNames.stop, () => this.autoStop());\n  };\n})(BookReader.prototype.init);\n\n/**\n * @override BookReader.bindNavigationHandlers\n */\nBookReader.prototype.bindNavigationHandlers = (function(super_) {\n  return function() {\n    super_.call(this);\n\n    if (!this.options.enableAutoPlayPlugin) return;\n\n    // Note the mobile plugin attaches itself to body, so we need to select outside\n    const jIcons = this.$('.BRicon').add('.BRmobileMenu .BRicon');\n\n    jIcons.filter('.play').click(() => {\n      this.autoToggle();\n      return false;\n    });\n\n    jIcons.filter('.pause').click(() => {\n      this.autoToggle();\n      return false;\n    });\n  };\n})(BookReader.prototype.bindNavigationHandlers);\n\n/**\n * Starts autoplay mode\n * @param {object} overrides\n * @param {number} overrides.flipSpeed\n * @param {number} overrides.flipDelay\n */\nBookReader.prototype.autoToggle = function(overrides) {\n  if (!this.options.enableAutoPlayPlugin) return;\n\n  const options = $.extend({\n    flipSpeed: this.flipSpeed,\n    flipDelay: this.flipDelay\n  }, overrides);\n\n  this.flipSpeed = typeof options.flipSpeed === \"number\" ? options.flipSpeed : this.flipSpeed;\n  this.flipDelay = typeof options.flipDelay === \"number\" ? options.flipDelay : this.flipDelay;\n  this.trigger(BookReader.eventNames.stop);\n\n  let bComingFrom1up = false;\n  if (this.constMode2up != this.mode) {\n    bComingFrom1up = true;\n    this.switchMode(this.constMode2up);\n  }\n\n  // Change to autofit if book is too large\n  if (this.reduce < this.twoPageGetAutofitReduce()) {\n    this.zoom('auto');\n  }\n\n  if (null == this.autoTimer) {\n    // $$$ Draw events currently cause layout problems when they occur during animation.\n    //     There is a specific problem when changing from 1-up immediately to autoplay in RTL so\n    //     we workaround for now by not triggering immediate animation in that case.\n    //     See https://bugs.launchpad.net/gnubook/+bug/328327\n    if (('rl' == this.pageProgression) && bComingFrom1up) {\n      // don't flip immediately -- wait until timer fires\n    } else {\n      // flip immediately\n      this.flipFwdToIndex();\n    }\n\n    this.$('.play').hide();\n    this.$('.pause').show();\n    this.autoTimer = setInterval(() => {\n      if (this.animating) return;\n\n      if (Math.max(this.twoPage.currentIndexL, this.twoPage.currentIndexR) >= this.lastDisplayableIndex()) {\n        this.flipBackToIndex(1); // $$$ really what we want?\n      } else {\n        this.flipFwdToIndex();\n      }\n    }, this.flipDelay);\n  } else {\n    this.autoStop();\n  }\n};\n\n/**\n * Stop autoplay mode, allowing animations to finish\n */\nBookReader.prototype.autoStop = function() {\n  if (!this.options.enableAutoPlayPlugin) return;\n\n  if (null != this.autoTimer) {\n    clearInterval(this.autoTimer);\n    this.flipSpeed = 'fast';\n    this.$('.pause').hide();\n    this.$('.play').show();\n    this.autoTimer = null;\n  }\n};\n"],"names":["jQuery","extend","BookReader","defaultOptions","enableAutoPlayPlugin","prototype","setup","super_","options","call","auto","autoTimer","flipDelay","init","bind","eventNames","stop","autoStop","bindNavigationHandlers","jIcons","$","add","filter","click","autoToggle","overrides","flipSpeed","trigger","bComingFrom1up","constMode2up","mode","switchMode","reduce","twoPageGetAutofitReduce","zoom","pageProgression","flipFwdToIndex","hide","show","setInterval","animating","Math","max","twoPage","currentIndexL","currentIndexR","lastDisplayableIndex","flipBackToIndex","clearInterval"],"sourceRoot":""}