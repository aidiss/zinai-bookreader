{"version":3,"file":"plugins/plugin.chapters.js","mappings":"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","sources":["webpack://@internetarchive/bookreader/./src/plugins/plugin.chapters.js"],"sourcesContent":["/* global BookReader */\n/**\n * Plugin for chapter markers in BookReader. Fetches from openlibrary.org\n * Could be forked, or extended to alter behavior\n */\n\njQuery.extend(BookReader.defaultOptions, {\n  olHost: 'https://openlibrary.org',\n  enableChaptersPlugin: true,\n  bookId: '',\n});\n\n/** @override Extend the constructor to add search properties */\nBookReader.prototype.setup = (function (super_) {\n  return function (options) {\n    super_.call(this, options);\n\n    this.olHost = options.olHost;\n    this.enableChaptersPlugin = options.enableChaptersPlugin;\n    this.bookId = options.bookId;\n  };\n})(BookReader.prototype.setup);\n\n/** @override Extend to call Open Library for TOC */\nBookReader.prototype.init = (function(super_) {\n  return function() {\n    super_.call(this);\n    if (this.enableChaptersPlugin && this.ui !== 'embed') {\n      this.getOpenLibraryRecord();\n    }\n    if (this.enableMobileNav) {\n      this.bind(BookReader.eventNames.mobileNavOpen,\n        () => {\n          this.updateTOCState(this.firstIndex, this._tocEntries);\n          if ($('table-contents-list').parent().hasClass('mm-opened')) {\n            this.updateTOCState(this.firstIndex, this._tocEntries);\n          }\n        }\n      );\n      $(\".BRmobileMenu__tableContents\").on(\"click\", () => {\n        this.updateTOCState(this.firstIndex, this._tocEntries);\n      });\n    }\n  };\n})(BookReader.prototype.init);\n\n/**\n * Adds chapter marker to navigation scrubber\n *\n * @param {string} chapterTitle\n * @param {string} pageNumber\n * @param {number} pageIndex\n */\nBookReader.prototype.addChapter = function(chapterTitle, pageNumber, pageIndex) {\n  const uiStringPage = 'Page'; // i18n\n  const percentThrough = BookReader.util.cssPercentage(pageIndex, this.getNumLeafs() - 1);\n  const jumpToChapter = (event) => {\n    this.jumpToIndex($(event.delegateTarget).data('pageIndex'));\n    $('.current-chapter').removeClass('current-chapter');\n    $(event.delegateTarget).addClass('current-chapter');\n  };\n  const title = `${chapterTitle} | `;\n  const pageStr = `${uiStringPage} ${pageNumber}`;\n\n  //adding items to mobile table of contents\n  const mobileChapter = $(`<li></li>`).append($(`<span class='BRTOCElementTitle'></span>`).text(title))\n    .append($(`<span class='BRTOCElementPage'></span>`).text(pageStr));\n  mobileChapter.addClass('BRtable-contents-el')\n    .appendTo(this.$('.table-contents-list'))\n    .data({ pageIndex });\n\n  //adds .BRchapters to the slider only if pageIndex exists\n  if (pageIndex != undefined) {\n    $(`<div></div>`)\n      .append($('<div />').text(title + pageStr))\n      .addClass('BRchapter')\n      .css({ left: percentThrough })\n      .appendTo(this.$('.BRnavline'))\n      .data({ pageIndex })\n      .on(\"mouseenter\", event => {\n        // remove hover effect from other markers then turn on just for this\n        const marker = event.currentTarget;\n        const tooltip = marker.querySelector('div');\n        const tooltipOffset = tooltip.getBoundingClientRect();\n        const targetOffset = marker.getBoundingClientRect();\n        const boxSizeAdjust = parseInt(getComputedStyle(tooltip).paddingLeft) * 2;\n        if (tooltipOffset.x - boxSizeAdjust < 0) {\n          tooltip.style.setProperty('transform', `translateX(-${targetOffset.left - boxSizeAdjust}px)`);\n        }\n        this.$('.BRsearch,.BRchapter').removeClass('front');\n        $(event.target).addClass('front');\n      })\n      .on(\"mouseleave\", event => $(event.target).removeClass('front'))\n      .on('click', jumpToChapter);\n\n    //adding clickable properties to mobile chapters\n    mobileChapter.bind('click', jumpToChapter)\n      .addClass('chapter-clickable')\n      .attr(\"data-event-click-tracking\",\"BRTOCPanel|GoToChapter\");\n  }\n\n};\n\n/*\n * Remove all chapters.\n */\nBookReader.prototype.removeChapters = function() {\n  this.$('.BRnavpos .BRchapter').remove();\n};\n\n/**\n * Update the table of contents based on array of TOC entries.\n * @param {TocEntry[]} tocEntries\n */\nBookReader.prototype.updateTOC = function(tocEntries) {\n  this.removeChapters();\n  if (this.enableMobileNav && tocEntries.length > 0) {\n    this.$(\".BRmobileMenu__tableContents\").show();\n  }\n  for (let i = 0; i < tocEntries.length; i++) {\n    this.addChapterFromEntry(tocEntries[i]);\n  }\n  this._tocEntries = tocEntries;\n  $('.table-contents-list').children().each((i, el) => {\n    tocEntries[i].mobileHTML = el;\n  });\n};\n\n/**\n * @typedef {Object} TocEntry\n * Table of contents entry as defined -- format is defined by Open Library\n * @property {string} pagenum\n * @property {number} level\n * @property {string} label\n * @property {{type: '/type/toc_item'}} type\n * @property {string} title\n * @property {HTMLElement} mobileHTML\n * @property {number} pageIndex\n\n *\n * @example {\n *   \"pagenum\": \"17\",\n *   \"level\": 1,\n *   \"label\": \"CHAPTER I\",\n *   \"type\": {\"key\": \"/type/toc_item\"},\n *   \"title\": \"THE COUNTRY AND THE MISSION\"\n * }\n */\n\n/**\n * @param {TocEntry} tocEntryObject\n */\nBookReader.prototype.addChapterFromEntry = function(tocEntryObject) {\n  tocEntryObject.pageIndex = this.getPageIndex(tocEntryObject['pagenum']);\n  //creates a string with non-void tocEntryObject.label and tocEntryObject.title\n  const chapterStr = [tocEntryObject.label, tocEntryObject.title]\n    .filter(x => x)\n    .join(' ');\n  this.addChapter(chapterStr, tocEntryObject['pagenum'], tocEntryObject.pageIndex);\n  this.$('.BRchapter, .BRsearch').each((i, el) => {\n    const $el = $(el);\n    $el\n      .on(\"mouseenter\", () => $el.addClass('front'))\n      .on(\"mouseleave\", () => $el.removeClass('front'));\n  });\n};\n\n/**\n * getOpenLibraryRecord\n *\n * The bookreader is designed to call openlibrary API and constructs the\n * \"Return book\" button using the response.\n *\n * This makes a call to OL API and calls the given callback function with the\n * response from the API.\n */\nBookReader.prototype.getOpenLibraryRecord = async function () {\n  // Try looking up by ocaid first, then by source_record\n  const baseURL = `${this.olHost}/query.json?type=/type/edition&*=`;\n  const fetchUrlByBookId = `${baseURL}&ocaid=${this.bookId}`;\n\n  /*\n  * Update Chapter markers based on received record from Open Library.\n  * Notes that Open Library record is used for extra metadata, and also for lending\n  */\n  const setUpChapterMarkers = (olObject) => {\n    if (olObject && olObject.table_of_contents) {\n      // XXX check here that TOC is valid\n      this.updateTOC(olObject.table_of_contents);\n    }\n  };\n\n  let data = await $.ajax({ url: fetchUrlByBookId, dataType: 'jsonp' });\n\n  if (!data || !data.length) {\n    // try sourceid\n    data = await $.ajax({ url: `${baseURL}&source_records=ia:${this.bookId}`, dataType: 'jsonp' });\n  }\n\n  if (data && data.length > 0) {\n    setUpChapterMarkers(data[0]);\n  }\n};\n\n// Extend buildMobileDrawerElement with table of contents list\nBookReader.prototype.buildMobileDrawerElement = (function (super_) {\n  return function () {\n    const $el = super_.call(this);\n    if (this.enableMobileNav && this.options.enableChaptersPlugin) {\n      $el.find('.BRmobileMenu__moreInfoRow').after($(`\n        <li class=\"BRmobileMenu__tableContents\" data-event-click-tracking=\"BRSidebar|TOCPanel\">\n            <span>\n                <span class=\"DrawerIconWrapper\">\n                  <img class=\"DrawerIcon\" src=\"${this.imagesBaseURL}icon_toc.svg\" alt=\"toc-icon\"/>\n                </span>\n                Table of Contents\n            </span>\n            <div>\n                <ol class=\"table-contents-list\">\n                </ol>\n            </div>\n        </li>`).hide());\n    }\n    return $el;\n  };\n})(BookReader.prototype.buildMobileDrawerElement);\n\n/**\n * highlights the current chapter based on current page\n * @private\n * @param {TocEntry[]} tocEntries\n * @param {number} tocEntries\n */\nBookReader.prototype.updateTOCState = function(currIndex, tocEntries) {\n  //this function won't have any effects if called before OpenLibrary request is finished\n  if (!tocEntries) {return;}\n  $('.current-chapter').removeClass('current-chapter');\n  const tocEntriesIndexed = tocEntries.filter((el) => el.pageIndex != undefined).reverse();\n  const currChapter = tocEntriesIndexed[tocEntriesIndexed.findIndex(\n    (el) => el.pageIndex <= currIndex)];\n  if (currChapter != undefined) {\n    $(currChapter.mobileHTML).addClass('current-chapter');\n  }\n};\n"],"names":["jQuery","extend","BookReader","defaultOptions","olHost","enableChaptersPlugin","bookId","prototype","setup","super_","options","call","init","ui","getOpenLibraryRecord","enableMobileNav","bind","eventNames","mobileNavOpen","updateTOCState","firstIndex","_tocEntries","$","parent","hasClass","on","addChapter","chapterTitle","pageNumber","pageIndex","uiStringPage","percentThrough","util","cssPercentage","getNumLeafs","jumpToChapter","event","jumpToIndex","delegateTarget","data","removeClass","addClass","title","pageStr","mobileChapter","append","text","appendTo","undefined","css","left","marker","currentTarget","tooltip","querySelector","tooltipOffset","getBoundingClientRect","targetOffset","boxSizeAdjust","parseInt","getComputedStyle","paddingLeft","x","style","setProperty","target","attr","removeChapters","remove","updateTOC","tocEntries","length","show","i","addChapterFromEntry","children","each","el","mobileHTML","tocEntryObject","getPageIndex","chapterStr","label","filter","join","$el","baseURL","fetchUrlByBookId","setUpChapterMarkers","olObject","table_of_contents","ajax","url","dataType","buildMobileDrawerElement","find","after","imagesBaseURL","hide","currIndex","tocEntriesIndexed","reverse","currChapter","findIndex"],"sourceRoot":""}