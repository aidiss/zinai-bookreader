{"version":3,"file":"plugins/plugin.search.js","mappings":"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","sources":["webpack://@internetarchive/bookreader/./src/plugins/search/plugin.search.js","webpack://@internetarchive/bookreader/./src/plugins/search/view.js","webpack://@internetarchive/bookreader/./node_modules/core-js/modules/es.object.entries.js"],"sourcesContent":["/* global BookReader */\n/**\n * Plugin for Archive.org book search\n * NOTE: This script must be loaded AFTER `plugin.mobile_nav.js`\n * as it mutates mobile nav drawer\n *\n * Events fired at various points throughout search processing are published\n * on the document DOM element. These can be subscribed to using jQuery's event\n * binding method `$.fn.on`. All of the events are prefixed with a BookReader\n * namespace. The events are:\n *\n * @event BookReader:SearchStarted - When a search form is submitted, immediately\n *   before an AJAX call is made to request search results\n * @event BookReader:SearchCallback - When the search AJAX call is returned and at\n *   least one result is returned. The event callback receives an object\n *   with the `results`, plugin `options`, and the BookReader `instance`\n * @event BookReader:SearchCallbackError - When the AJAX request returns an error.\n *   Receives the `results` and `instance`\n * @event BookReader:SearchCallbackNotIndexed - When a message is received that\n *   the book has not had OCR text indexed yet. Receives `instance`\n * @event BookReader:SearchCallbackEmpty - When no results found. Receives\n *   `instance`\n * @event BookReader:SearchCanceled - When no results found. Receives\n *   `instance`\n */\nimport { renderBoxesInPageContainerLayer } from '../../BookReader/PageContainer.js';\nimport SearchView from './view.js';\n/** @typedef {import('../../BookReader/PageContainer').PageContainer} PageContainer */\n/** @typedef {import('../../BookReader/BookModel').PageIndex} PageIndex */\n\njQuery.extend(BookReader.defaultOptions, {\n  server: 'ia600609.us.archive.org',\n  bookId: '',\n  subPrefix: '',\n  bookPath: '',\n  enableSearch: true,\n  searchInsideUrl: '/fulltext/inside.php',\n  initialSearchTerm: null,\n});\n\n/** @override */\nBookReader.prototype.setup = (function (super_) {\n  return function (options) {\n    super_.call(this, options);\n\n    this.searchTerm = '';\n    this.searchResults = null;\n    this.searchInsideUrl = options.searchInsideUrl;\n    this.enableSearch = options.enableSearch;\n\n    // Base server used by some api calls\n    this.bookId = options.bookId;\n    this.server = options.server;\n    this.subPrefix = options.subPrefix;\n    this.bookPath = options.bookPath;\n\n    this.searchXHR = null;\n    this._cancelSearch.bind(this);\n    this.cancelSearchRequest.bind(this);\n\n    /** @type { {[pageIndex: number]: SearchInsideMatchBox[]} } */\n    this._searchBoxesByIndex = {};\n\n    this.searchView = undefined;\n  };\n})(BookReader.prototype.setup);\n\n/** @override */\nBookReader.prototype.init = (function (super_) {\n  return function () {\n    super_.call(this);\n    // give SearchView the most complete bookreader state\n    this.searchView = new SearchView({\n      br: this,\n      searchCancelledCallback: () => {\n        this._cancelSearch();\n        this.trigger('SearchCanceled', { term: this.searchTerm, instance: this });\n      }\n    });\n    if (this.options.enableSearch && this.options.initialSearchTerm) {\n      /**\n       * this.search() take two parameter\n       * 1. this.options.initialSearchTerm - search term\n       * 2. {\n       *  goToFirstResult: this.options.goToFirstResult,\n       *  suppressFragmentChange: false // always want to change fragment in URL\n       * }\n       */\n      this.search(\n        this.options.initialSearchTerm,\n        { goToFirstResult: this.options.goToFirstResult, suppressFragmentChange: false }\n      );\n    }\n  };\n})(BookReader.prototype.init);\n\n/** @override */\nBookReader.prototype.buildToolbarElement = (function (super_) {\n  return function () {\n    const $el = super_.call(this);\n    if (!this.enableSearch) { return; }\n    if (this.searchView.dom.toolbarSearch) {\n      $el.find('.BRtoolbarSectionInfo').after(this.searchView.dom.toolbarSearch);\n    }\n    return $el;\n  };\n})(BookReader.prototype.buildToolbarElement);\n\n/** @override */\nBookReader.prototype._createPageContainer = (function (super_) {\n  return function (index) {\n    const pageContainer = super_.call(this, index);\n    if (this.enableSearch && pageContainer.page && index in this._searchBoxesByIndex) {\n      const pageIndex = pageContainer.page.index;\n      renderBoxesInPageContainerLayer('searchHiliteLayer', this._searchBoxesByIndex[pageIndex], pageContainer.page, pageContainer.$container[0]);\n    }\n    return pageContainer;\n  };\n})(BookReader.prototype._createPageContainer);\n\n/**\n * @typedef {object} SearchOptions\n * @property {boolean} goToFirstResult\n * @property {boolean} disablePopup\n * @property {(null|function)} error - @deprecated at v.5.0\n * @property {(null|function)} success - @deprecated at v.5.0\n */\n\n/**\n * Submits search request\n *\n * @param {string} term\n * @param {SearchOptions} overrides\n */\nBookReader.prototype.search = async function(term = '', overrides = {}) {\n  /** @type {SearchOptions} */\n  const defaultOptions = {\n    goToFirstResult: false, /* jump to the first result (default=false) */\n    disablePopup: false,    /* don't show the modal progress (default=false) */\n    suppressFragmentChange: false, /* don't change the URL on initial load */\n    error: null,            /* optional error handler (default=null) */\n    success: null,          /* optional success handler (default=null) */\n\n  };\n  const options = jQuery.extend({}, defaultOptions, overrides);\n  this.suppressFragmentChange = options.suppressFragmentChange;\n\n  // strip slashes, since this goes in the url\n  this.searchTerm = term.replace(/\\//g, ' ');\n\n  if (!options.suppressFragmentChange) {\n    this.trigger(BookReader.eventNames.fragmentChange);\n  }\n\n  // Add quotes to the term. This is to compenstate for the backends default OR query\n  // term = term.replace(/['\"]+/g, '');\n  // term = '\"' + term + '\"';\n\n  // Remove the port and userdir\n  const serverPath = this.server.replace(/:.+/, '');\n  const baseUrl = `https://${serverPath}${this.searchInsideUrl}?`;\n\n  // Remove subPrefix from end of path\n  let path = this.bookPath;\n  const subPrefixWithSlash = `/${this.subPrefix}`;\n  if (this.bookPath.length - this.bookPath.lastIndexOf(subPrefixWithSlash) == subPrefixWithSlash.length) {\n    path = this.bookPath.substr(0, this.bookPath.length - subPrefixWithSlash.length);\n  }\n\n  const urlParams = {\n    item_id: this.bookId,\n    doc: this.subPrefix,\n    path,\n    q: term,\n  };\n\n  // NOTE that the API does not expect / (slashes) to be encoded. (%2F) won't work\n  const paramStr = $.param(urlParams).replace(/%2F/g, '/');\n\n  const url = `${baseUrl}${paramStr}`;\n\n  const cleanup = () => {\n    this.searchXHR = null;\n    window.BRSearchInProgress = () => {};\n  };\n\n  const processSearchResults = (searchInsideResults) => {\n    if (!this.searchXHR) {\n      return;\n    }\n    const responseHasError = searchInsideResults.error || !searchInsideResults.matches.length;\n    const hasCustomError = typeof options.error === 'function';\n    const hasCustomSuccess = typeof options.success === 'function';\n\n    if (responseHasError) {\n      hasCustomError\n        ? options.error.call(this, searchInsideResults, options)\n        : this.BRSearchCallbackError(searchInsideResults, options);\n    } else {\n      hasCustomSuccess\n        ? options.success.call(this, searchInsideResults, options)\n        : this.BRSearchCallback(searchInsideResults, options);\n    }\n    cleanup();\n  };\n\n  const beforeSend = (xhr) => {\n    this.searchXHR = xhr;\n    window.BRSearchInProgress = processSearchResults;\n  };\n\n  this.trigger('SearchStarted', { term: this.searchTerm, instance: this });\n  return processSearchResults(await $.ajax({\n    url: url,\n    dataType: 'jsonp',\n    cache: true,\n    beforeSend,\n    jsonpCallback: 'BRSearchInProgress'\n  }));\n};\n\n/**\n * cancels AJAX Call\n * emits custom event\n */\nBookReader.prototype._cancelSearch = function () {\n  this.searchXHR?.abort();\n  this.searchView.clearSearchFieldAndResults(false);\n  this.searchTerm = '';\n  this.searchXHR = null;\n  this.searchResults = [];\n  window.BRSearchInProgress = () => {};\n};\n\n/**\n * External function to cancel search\n * checks for term & xhr in flight before running\n */\nBookReader.prototype.cancelSearchRequest = function () {\n  if (this.searchXHR !== null) {\n    this._cancelSearch();\n    this.searchView.toggleSearchPending();\n    this.trigger('SearchCanceled', { term: this.searchTerm, instance: this });\n  }\n};\n\n/**\n  * @typedef {object} SearchInsideMatchBox\n  * @property {number} page\n  * @property {number} r\n  * @property {number} l\n  * @property {number} b\n  * @property {number} t\n  * @property {HTMLDivElement} [div]\n  */\n\n/**\n * @typedef {object} SearchInsideMatch\n * @property {string} text\n * @property {Array<{ page: number, boxes: SearchInsideMatchBox[] }>} par\n */\n\n/**\n * @typedef {object} SearchInsideResults\n * @property {string} error\n * @property {SearchInsideMatch[]} matches\n * @property {boolean} indexed\n */\n\n/**\n * Search Results return handler\n * @callback\n * @param {SearchInsideResults} results\n * @param {object} options\n * @param {boolean} options.goToFirstResult\n */\nBookReader.prototype.BRSearchCallback = function(results, options) {\n  this.searchResults = results || [];\n\n  this.updateSearchHilites();\n  this.removeProgressPopup();\n  if (options.goToFirstResult) {\n    const pageIndex = this._models.book.leafNumToIndex(results.matches[0].par[0].page);\n    this._searchPluginGoToResult(pageIndex);\n  }\n  this.trigger('SearchCallback', { results, options, instance: this });\n};\n\n/**\n * Main search results error handler\n * @callback\n * @param {SearchInsideResults} results\n */\nBookReader.prototype.BRSearchCallbackError = function(results) {\n  this._BRSearchCallbackError(results);\n};\n\n/**\n * @private draws search results error\n * @callback\n * @param {SearchInsideResults} results\n * @param {jQuery} $el\n * @param {boolean} fade\n */\nBookReader.prototype._BRSearchCallbackError = function(results) {\n  this.searchResults = results;\n  const basePayload = {\n    term: this.searchTerm,\n    instance: this,\n  };\n  if (results.error) {\n    const payload = Object.assign({}, basePayload, { results });\n    this.trigger('SearchCallbackError', payload);\n  } else if (0 == results.matches.length) {\n    if (false === results.indexed) {\n      this.trigger('SearchCallbackBookNotIndexed', basePayload);\n      return;\n    }\n    this.trigger('SearchCallbackEmpty', basePayload);\n  }\n};\n\n/**\n * updates search on-page highlights controller\n */\nBookReader.prototype.updateSearchHilites = function() {\n  /** @type {SearchInsideMatch[]} */\n  const matches = this.searchResults?.matches || [];\n  /** @type { {[pageIndex: number]: SearchInsideMatch[]} } */\n  const boxesByIndex = {};\n\n  // Clear any existing svg layers\n  this.removeSearchHilites();\n\n  // Group by pageIndex\n  for (const match of matches) {\n    for (const box of match.par[0].boxes) {\n      const pageIndex = this.leafNumToIndex(box.page);\n      const pageMatches = boxesByIndex[pageIndex] || (boxesByIndex[pageIndex] = []);\n      pageMatches.push(box);\n    }\n  }\n\n  // update any already created pages\n  for (const [pageIndexString, boxes] of Object.entries(boxesByIndex)) {\n    const pageIndex = parseFloat(pageIndexString);\n    const page = this._models.book.getPage(pageIndex);\n    const pageContainers = this.getActivePageContainerElementsForIndex(pageIndex);\n    pageContainers.forEach(container => renderBoxesInPageContainerLayer('searchHiliteLayer', boxes, page, container));\n  }\n\n  this._searchBoxesByIndex = boxesByIndex;\n};\n\n/**\n * remove search highlights\n */\nBookReader.prototype.removeSearchHilites = function() {\n  $(this.getActivePageContainerElements()).find('.searchHiliteLayer').remove();\n};\n\n/**\n * @private\n * Goes to the page specified. If the page is not viewable, tries to load the page\n * FIXME Most of this logic is IA specific, and should be less integrated into here\n * or at least more configurable.\n * @param {PageIndex} pageIndex\n */\nBookReader.prototype._searchPluginGoToResult = async function (pageIndex) {\n  const { book } = this._models;\n  const page = book.getPage(pageIndex);\n  let makeUnviewableAtEnd = false;\n  if (!page.isViewable) {\n    const resp = await fetch('/services/bookreader/request_page?' + new URLSearchParams({\n      id: this.options.bookId,\n      subprefix: this.options.subPrefix,\n      leafNum: page.leafNum,\n    })).then(r => r.json());\n\n    for (const leafNum of resp.value) {\n      book.getPage(book.leafNumToIndex(leafNum)).makeViewable();\n    }\n\n    // not able to show page; make the page viewable anyways so that it can\n    // actually open. On IA, it has a fallback to a special error page.\n    if (!resp.value.length) {\n      book.getPage(pageIndex).makeViewable();\n      makeUnviewableAtEnd = true;\n    }\n  }\n  /* this updates the URL */\n  this.suppressFragmentChange = false;\n  this.jumpToIndex(pageIndex);\n\n  // Reset it to unviewable if it wasn't resolved\n  if (makeUnviewableAtEnd) {\n    book.getPage(pageIndex).makeViewable(false);\n  }\n};\n\n/**\n * Removes all search pins\n */\nBookReader.prototype.removeSearchResults = function(suppressFragmentChange = false) {\n  this.removeSearchHilites(); //be sure to set all box.divs to null\n  this.searchTerm = null;\n  this.searchResults = null;\n  if (!suppressFragmentChange) {\n    this.trigger(BookReader.eventNames.fragmentChange);\n  }\n};\n\n/**\n * Returns true if a search highlight is currently being displayed\n * @returns {boolean}\n */\nBookReader.prototype.searchHighlightVisible = function() {\n  const results = this.searchResults;\n  let visiblePages = [];\n  if (null == results) return false;\n\n  if (this.constMode2up == this.mode) {\n    visiblePages = [this.twoPage.currentIndexL, this.twoPage.currentIndexR];\n  } else if (this.constMode1up == this.mode) {\n    visiblePages = [this.currentIndex()];\n  } else {\n    return false;\n  }\n\n  results.matches.some(match => {\n    return match.par[0].boxes.some(box => {\n      const pageIndex = this.leafNumToIndex(box.page);\n      if (jQuery.inArray(pageIndex, visiblePages) >= 0) {\n        return true;\n      }\n    });\n  });\n\n  return false;\n};\n","class SearchView {\n  /**\n   * @param {object} params\n   * @param {object} params.br The BookReader instance\n   * @param {function} params.cancelSearch callback when a user wants to cancel search\n   *\n   * @event BookReader:SearchResultsCleared - when the search results nav gets cleared\n   * @event BookReader:ToggleSearchMenu - when search results menu should toggle\n   */\n  constructor({ br, searchCancelledCallback = () => {} }) {\n    this.br = br;\n\n    // Search results are returned as a text blob with the hits wrapped in\n    // triple mustaches. Hits occasionally include text beyond the search\n    // term, so everything within the staches is captured and wrapped.\n    this.matcher = new RegExp('{{{(.+?)}}}', 'g');\n    this.matches = [];\n    this.cacheDOMElements();\n    this.bindEvents();\n    this.cancelSearch = searchCancelledCallback;\n  }\n\n  cacheDOMElements() {\n    this.dom = {};\n    // Search input within the top toolbar. Will be removed once the mobile menu is replaced.\n    this.dom.toolbarSearch = this.buildToolbarSearch();\n  }\n\n  /**\n   * @param {string} query\n   */\n  setQuery(query) {\n    this.br.$('[name=\"query\"]').val(query);\n  }\n\n  emptyMatches() {\n    this.matches = [];\n  }\n\n  removeResultPins() {\n    this.br.$('.BRnavpos .BRsearch').remove();\n  }\n\n  clearSearchFieldAndResults(dispatchEventWhenComplete = true) {\n    this.br.removeSearchResults();\n    this.removeResultPins();\n    this.emptyMatches();\n    this.setQuery('');\n    this.teardownSearchNavigation();\n    if (dispatchEventWhenComplete) {\n      this.br.trigger('SearchResultsCleared');\n    }\n  }\n\n  toggleSidebar() {\n    this.br.trigger('ToggleSearchMenu');\n  }\n\n  renderSearchNavigation() {\n    const selector = 'BRsearch-navigation';\n    $('.BRnav').before(`\n      <div class=\"${selector}\">\n        <button class=\"toggle-sidebar\">\n          <h4>\n            <span class=\"icon icon-search\"></span> Results\n          </h4>\n        </button>\n        <div class=\"pagination\">\n          <button class=\"prev\" title=\"Previous result\"><span class=\"icon icon-chevron hflip\"></span></button>\n          <span data-id=\"resultsCount\">${this.resultsPosition()}</span>\n          <button class=\"next\" title=\"Next result\"><span class=\"icon icon-chevron\"></button>\n        </div>\n        <button class=\"clear\" title=\"Clear search results\">\n          <span class=\"icon icon-close\"></span>\n        </button>\n      </div>\n    `);\n    this.dom.searchNavigation = $(`.${selector}`);\n  }\n\n  resultsPosition() {\n    let positionMessage = `${this.matches.length} result${this.matches.length === 1 ? '' : 's'}`;\n    if (~this.currentMatchIndex) {\n      positionMessage = `${this.currentMatchIndex + 1} / ${this.matches.length}`;\n    }\n    return positionMessage;\n  }\n\n  bindSearchNavigationEvents() {\n    if (!this.dom.searchNavigation) { return; }\n    const namespace = 'searchNavigation';\n\n    this.dom.searchNavigation\n      .on(`click.${namespace}`, '.clear', this.clearSearchFieldAndResults.bind(this))\n      .on(`click.${namespace}`, '.prev', this.showPrevResult.bind(this))\n      .on(`click.${namespace}`, '.next', this.showNextResult.bind(this))\n      .on(`click.${namespace}`, '.toggle-sidebar', this.toggleSidebar.bind(this))\n      .on(`click.${namespace}`, false);\n  }\n\n  showPrevResult() {\n    if (this.currentMatchIndex === 0) { return; }\n    if (this.br.mode === this.br.constModeThumb) { this.br.switchMode(this.br.constMode1up); }\n    if (!~this.currentMatchIndex) {\n      this.currentMatchIndex = this.getClosestMatchIndex((start, end, comparator) => end[0] > comparator) + 1;\n    }\n    this.br.$('.BRnavline .BRsearch').eq(--this.currentMatchIndex).click();\n    this.updateResultsPosition();\n    this.updateSearchNavigationButtons();\n  }\n\n  showNextResult() {\n    if (this.currentMatchIndex + 1 === this.matches.length) { return; }\n    if (this.br.mode === this.br.constModeThumb) { this.br.switchMode(this.br.constMode1up); }\n    if (!~this.currentMatchIndex) {\n      this.currentMatchIndex = this.getClosestMatchIndex((start, end, comparator) => start[start.length - 1] > comparator) - 1;\n    }\n    this.br.$('.BRnavline .BRsearch').eq(++this.currentMatchIndex).click();\n    this.updateResultsPosition();\n    this.updateSearchNavigationButtons();\n  }\n\n  /**\n   * Obtains closest match based on the logical comparison function passed in.\n   * When the comparison function returns true, the starting (left) half of the\n   * matches array is used in the binary split, else the ending (right) half is\n   * used. A recursive call is made to perform the same split and comparison\n   * on the winning half of the matches. This is traditionally known as binary\n   * search (https://en.wikipedia.org/wiki/Binary_search_algorithm), and in\n   * most cases (medium to large search result arrays) should outperform\n   * traversing the array from start to finish. In the case of small arrays,\n   * the speed difference is negligible.\n   *\n   * @param {function} comparisonFn\n   * @return {number} matchIndex\n   */\n  getClosestMatchIndex(comparisonFn) {\n    const matchPages = this.matches.map((m) => m.par[0].page);\n    const currentPage = this.br.currentIndex() + 1;\n    const closestTo = (pool, comparator) => {\n      if (pool.length === 1) { return pool[0]; }\n      const start = pool.slice(0, pool.length / 2);\n      const end = pool.slice(pool.length / 2);\n      return closestTo((comparisonFn(start, end, comparator) ? start : end), comparator);\n    };\n\n    const closestPage = closestTo(matchPages, currentPage);\n    return this.matches.indexOf(this.matches.find((m) => m.par[0].page === closestPage));\n  }\n\n  updateResultsPosition() {\n    this.dom.searchNavigation.find('[data-id=resultsCount]').text(this.resultsPosition());\n  }\n\n  updateSearchNavigationButtons() {\n    this.dom.searchNavigation.find('.prev').attr('disabled', !this.currentMatchIndex);\n    this.dom.searchNavigation.find('.next').attr('disabled', this.currentMatchIndex + 1 === this.matches.length);\n  }\n\n  teardownSearchNavigation() {\n    if (!this.dom.searchNavigation) {\n      this.dom.searchNavigation = $('.BRsearch-navigation');\n    }\n    if (!this.dom.searchNavigation.length) { return; }\n\n    this.dom.searchNavigation.off('.searchNavigation').remove();\n    this.dom.searchNavigation = null;\n    this.br.resize();\n  }\n\n  setCurrentMatchIndex() {\n    let matchingSearchResult;\n    if (this.br.mode === this.br.constModeThumb) {\n      this.currentMatchIndex = -1;\n      return;\n    }\n    if (this.br.mode === this.br.constMode2up) {\n      matchingSearchResult = this.find2upMatchingSearchResult();\n    }\n    else {\n      matchingSearchResult = this.find1upMatchingSearchResult();\n    }\n    this.currentMatchIndex = this.matches.indexOf(matchingSearchResult);\n  }\n\n  find1upMatchingSearchResult() {\n    return this.matches.find((m) => this.br.currentIndex() === m.par[0].page - 1);\n  }\n\n  find2upMatchingSearchResult() {\n    return this.matches.find((m) => this.br._isIndexDisplayed(m.par[0].page - 1));\n  }\n\n  updateSearchNavigation() {\n    if (!this.matches.length) { return; }\n\n    this.setCurrentMatchIndex();\n    this.updateResultsPosition();\n    this.updateSearchNavigationButtons();\n  }\n\n  /**\n   * @param {boolean} bool\n   */\n  togglePinsFor(bool) {\n    const pinsVisibleState = bool ? 'visible' : 'hidden';\n    this.br.refs.$BRfooter.find('.BRsearch').css({ visibility: pinsVisibleState });\n  }\n\n  buildToolbarSearch() {\n    const toolbarSearch = document.createElement('span');\n    toolbarSearch.classList.add('BRtoolbarSection', 'BRtoolbarSectionSearch');\n    toolbarSearch.innerHTML = `\n      <form class=\"BRbooksearch desktop\">\n        <input type=\"search\" name=\"query\" class=\"BRsearchInput\" value=\"\" placeholder=\"Search inside\"/>\n        <button type=\"submit\" class=\"BRsearchSubmit\">\n          <img src=\"${this.br.imagesBaseURL}icon_search_button.svg\" />\n        </button>\n      </form>\n    `;\n    return toolbarSearch;\n  }\n\n  /**\n   * @param {array} matches\n   */\n  renderPins(matches) {\n    matches.forEach((match) => {\n      const queryString = match.text;\n      const pageIndex = this.br.leafNumToIndex(match.par[0].page);\n      const pageNumber = this.br.getPageNum(pageIndex);\n      const uiStringSearch = \"Search result\"; // i18n\n      const uiStringPage = \"Page\"; // i18n\n\n      const percentThrough = this.br.constructor.util.cssPercentage(pageIndex, this.br.getNumLeafs() - 1);\n\n      const queryStringWithB = queryString.replace(this.matcher, '<b>$1</b>');\n\n      let queryStringWithBTruncated = '';\n\n      if (queryString.length > 100) {\n        queryStringWithBTruncated = queryString\n          .replace(/^(.{100}[^\\s]*).*/, \"$1\")\n          .replace(this.matcher, '<b>$1</b>')\n                + '...';\n      }\n\n      // draw marker\n      $('<div>')\n        .addClass('BRsearch')\n        .css({\n          left: percentThrough,\n        })\n        .attr('title', uiStringSearch)\n        .append(`\n          <div class=\"BRquery\">\n            <div>${queryStringWithBTruncated || queryStringWithB}</div>\n            <div>${uiStringPage} ${pageNumber}</div>\n          </div>\n        `)\n        .data({ pageIndex })\n        .appendTo(this.br.$('.BRnavline'))\n        .on(\"mouseenter\", (event) => {\n          // remove from other markers then turn on just for this\n          // XXX should be done when nav slider moves\n          const marker = event.currentTarget;\n          const tooltip = marker.querySelector('.BRquery');\n          const tooltipOffset = tooltip.getBoundingClientRect();\n          const targetOffset = marker.getBoundingClientRect();\n          const boxSizeAdjust = parseInt(getComputedStyle(tooltip).paddingLeft) * 2;\n          if (tooltipOffset.x - boxSizeAdjust < 0) {\n            tooltip.style.setProperty('transform', `translateX(-${targetOffset.left - boxSizeAdjust}px)`);\n          }\n          $('.BRsearch,.BRchapter').removeClass('front');\n          $(event.target).addClass('front');\n        })\n        .on(\"mouseleave\", (event) => $(event.target).removeClass('front'))\n        .on(\"click\", function (event) {\n          // closures are nested and deep, using an arrow function breaks references.\n          // Todo: update to arrow function & clean up closures\n          // to remove `bind` dependency\n          this.br._searchPluginGoToResult(+$(event.target).data('pageIndex'));\n        }.bind(this));\n    });\n  }\n\n  /**\n   * @param {boolean} bool\n   */\n  toggleSearchPending(bool) {\n    if (bool) {\n      this.br.showProgressPopup(\"Search results will appear below...\", () => this.progressPopupClosed());\n    }\n    else {\n      this.br.removeProgressPopup();\n    }\n  }\n\n  /**\n   * Primary callback when user cancels search popup\n   */\n  progressPopupClosed() {\n    this.toggleSearchPending();\n    this.cancelSearch();\n  }\n\n  renderErrorModal(textIsProcessing = false) {\n    const errorDetails = `${!textIsProcessing ? 'The text may still be processing. ' : ''}Please try again.`;\n    this.renderModalMessage(`\n      Sorry, there was an error with your search.\n      <br />\n      ${errorDetails}\n    `);\n    this.delayModalRemovalFor(4000);\n  }\n\n  renderBookNotIndexedModal() {\n    this.renderModalMessage(`\n      <p>\n         This book hasn't been indexed for searching yet.\n         We've just started indexing it, so search should be available soon.\n         <br />\n         Please try again later. Thanks!\n      </p>\n    `);\n    this.delayModalRemovalFor(5000);\n  }\n\n  renderResultsEmptyModal() {\n    this.renderModalMessage('No matches were found.');\n    this.delayModalRemovalFor(2000);\n  }\n\n  /**\n   * @param {string} messageHTML The innerHTML string used to popupate the modal contents\n   */\n  renderModalMessage(messageHTML) {\n    const modal = document.createElement('div');\n    modal.classList.add('BRprogresspopup', 'search_modal');\n    modal.innerHTML = messageHTML;\n    document.querySelector(this.br.el).append(modal);\n  }\n\n  /**\n   * @param {number} timeoutMS\n   */\n  delayModalRemovalFor(timeoutMS) {\n    setTimeout(this.br.removeProgressPopup.bind(this.br), timeoutMS);\n  }\n\n  /**\n   * @param {Event} e\n   */\n  submitHandler(e) {\n    e.preventDefault();\n    const query = e.target.querySelector('[name=\"query\"]').value;\n    if (!query.length) { return false; }\n    this.br.search(query);\n    this.emptyMatches();\n    this.toggleSearchPending(true);\n    return false;\n  }\n\n  /**\n   * @param {Event} e\n   * @param {object} properties\n   *   @param {object} properties.results\n   *   @param {object} properties.options\n   */\n  handleSearchCallback(e, { results, options }) {\n    this.matches = results.matches;\n    this.setCurrentMatchIndex();\n    this.teardownSearchNavigation();\n    this.renderSearchNavigation();\n    this.bindSearchNavigationEvents();\n    this.renderPins(results.matches);\n    this.toggleSearchPending(false);\n    if (options.goToFirstResult) {\n      $(document).one('BookReader:pageChanged', () => {\n        this.br.resize();\n      });\n    } else {\n      this.br.resize();\n    }\n  }\n\n  /**\n   * @param {Event} e\n   */\n  handleNavToggledCallback(e) {\n    const is_visible = this.br.navigationIsVisible();\n    this.togglePinsFor(is_visible);\n  }\n\n  handleSearchStarted() {\n    this.emptyMatches();\n    this.br.removeSearchHilites();\n    this.removeResultPins();\n    this.toggleSearchPending(true);\n    this.teardownSearchNavigation();\n    this.setQuery(this.br.searchTerm);\n  }\n\n  /**\n   * Event listener for: `BookReader:SearchCallbackError`\n   * @param {CustomEvent} event\n   */\n  handleSearchCallbackError(event = {}) {\n    this.toggleSearchPending(false);\n    const isIndexed = event?.detail?.props?.results?.indexed;\n    this.renderErrorModal(isIndexed);\n  }\n\n  handleSearchCallbackBookNotIndexed() {\n    this.toggleSearchPending(false);\n    this.renderBookNotIndexedModal();\n  }\n\n  handleSearchCallbackEmpty() {\n    this.toggleSearchPending(false);\n    this.renderResultsEmptyModal();\n  }\n\n  bindEvents() {\n    const namespace = 'BookReader:';\n\n    window.addEventListener(`${namespace}SearchCallbackError`, this.handleSearchCallbackError.bind(this));\n    $(document).on(`${namespace}SearchCallback`, this.handleSearchCallback.bind(this))\n      .on(`${namespace}navToggled`, this.handleNavToggledCallback.bind(this))\n      .on(`${namespace}SearchStarted`, this.handleSearchStarted.bind(this))\n      .on(`${namespace}SearchCallbackBookNotIndexed`, this.handleSearchCallbackBookNotIndexed.bind(this))\n      .on(`${namespace}SearchCallbackEmpty`, this.handleSearchCallbackEmpty.bind(this))\n      .on(`${namespace}pageChanged`, this.updateSearchNavigation.bind(this));\n\n    this.dom.toolbarSearch.querySelector('form').addEventListener('submit', this.submitHandler.bind(this));\n  }\n}\n\nexport default SearchView;\n","var $ = require('../internals/export');\nvar $entries = require('../internals/object-to-array').entries;\n\n// `Object.entries` method\n// https://tc39.es/ecma262/#sec-object.entries\n$({ target: 'Object', stat: true }, {\n  entries: function entries(O) {\n    return $entries(O);\n  }\n});\n"],"names":["renderBoxesInPageContainerLayer","SearchView","jQuery","extend","BookReader","defaultOptions","server","bookId","subPrefix","bookPath","enableSearch","searchInsideUrl","initialSearchTerm","prototype","setup","super_","options","call","searchTerm","searchResults","searchXHR","_cancelSearch","bind","cancelSearchRequest","_searchBoxesByIndex","searchView","undefined","init","br","searchCancelledCallback","trigger","term","instance","search","goToFirstResult","suppressFragmentChange","buildToolbarElement","$el","dom","toolbarSearch","find","after","_createPageContainer","index","pageContainer","page","pageIndex","$container","overrides","disablePopup","error","success","replace","eventNames","fragmentChange","serverPath","baseUrl","path","subPrefixWithSlash","length","lastIndexOf","substr","urlParams","item_id","doc","q","paramStr","$","param","url","cleanup","window","BRSearchInProgress","processSearchResults","searchInsideResults","responseHasError","matches","hasCustomError","hasCustomSuccess","BRSearchCallbackError","BRSearchCallback","beforeSend","xhr","ajax","dataType","cache","jsonpCallback","abort","clearSearchFieldAndResults","toggleSearchPending","results","updateSearchHilites","removeProgressPopup","_models","book","leafNumToIndex","par","_searchPluginGoToResult","_BRSearchCallbackError","basePayload","payload","Object","assign","indexed","boxesByIndex","removeSearchHilites","match","boxes","box","pageMatches","push","pageIndexString","parseFloat","getPage","pageContainers","getActivePageContainerElementsForIndex","forEach","container","entries","getActivePageContainerElements","remove","makeUnviewableAtEnd","isViewable","fetch","URLSearchParams","id","subprefix","leafNum","then","r","json","resp","value","makeViewable","jumpToIndex","removeSearchResults","searchHighlightVisible","visiblePages","constMode2up","mode","twoPage","currentIndexL","currentIndexR","constMode1up","currentIndex","some","inArray","matcher","RegExp","cacheDOMElements","bindEvents","cancelSearch","buildToolbarSearch","query","val","dispatchEventWhenComplete","removeResultPins","emptyMatches","setQuery","teardownSearchNavigation","selector","before","resultsPosition","searchNavigation","positionMessage","currentMatchIndex","namespace","on","showPrevResult","showNextResult","toggleSidebar","constModeThumb","switchMode","getClosestMatchIndex","start","end","comparator","eq","click","updateResultsPosition","updateSearchNavigationButtons","comparisonFn","matchPages","map","m","currentPage","closestTo","pool","slice","closestPage","indexOf","text","attr","off","resize","matchingSearchResult","find2upMatchingSearchResult","find1upMatchingSearchResult","_isIndexDisplayed","setCurrentMatchIndex","bool","pinsVisibleState","refs","$BRfooter","css","visibility","document","createElement","classList","add","innerHTML","imagesBaseURL","queryString","pageNumber","getPageNum","uiStringSearch","uiStringPage","percentThrough","constructor","util","cssPercentage","getNumLeafs","queryStringWithB","queryStringWithBTruncated","addClass","left","append","data","appendTo","event","marker","currentTarget","tooltip","querySelector","tooltipOffset","getBoundingClientRect","targetOffset","boxSizeAdjust","parseInt","getComputedStyle","paddingLeft","x","style","setProperty","removeClass","target","showProgressPopup","progressPopupClosed","textIsProcessing","errorDetails","renderModalMessage","delayModalRemovalFor","messageHTML","modal","el","timeoutMS","setTimeout","e","preventDefault","renderSearchNavigation","bindSearchNavigationEvents","renderPins","one","is_visible","navigationIsVisible","togglePinsFor","isIndexed","detail","props","renderErrorModal","renderBookNotIndexedModal","renderResultsEmptyModal","addEventListener","handleSearchCallbackError","handleSearchCallback","handleNavToggledCallback","handleSearchStarted","handleSearchCallbackBookNotIndexed","handleSearchCallbackEmpty","updateSearchNavigation","submitHandler"],"sourceRoot":""}